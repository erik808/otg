function [V, S] = eigfreq(cipherFile, plainFile, repeatLength)
% Correlate the eigenvector against a frequency vector for known plaintext

% Generate adjacency matrix and map from the cipher
adjFile = ".adj.txt";
mapFile1 = ".map1.txt";
pairgraphCommand = sprintf("../pairgraph/pairgraph %s %d %s %s", 
			   cipherFile, repeatLength, adjFile, mapFile1);
system(pairgraphCommand);

% Generate substitution matrix
substitutionFile = ".subsmat.txt";
mapFile2 = ".map2.txt";
substitutionCommand = sprintf("../substitution_matrix/substitution_matrix %s %s %s %s", 
			      cipherFile, plainFile, substitutionFile, mapFile2);
system(substitutionCommand);

% Compute principal eigenvector for the matrix
A = sparse(load(adjFile));
[V, ~] = eigs(A, 1);
V = abs(V) ./ max(abs(V));

% Letter-frequency in English
freq = load('letter_freq_en.mat');
freq = freq.freq;

% Load substitution matrix
S = load(substitutionFile);

% Multiply with frequency-distribution
S = (S * freq) ./ max(freq);

% Show trend
n = 20;
x = linspace(0, max(S), n);
mu = zeros(1, n-1);
sig = zeros(1, n-1);
for i = 1:n-1
    select = V(S > x(i) & S < x(i+1));
    if isempty(select)
       continue
    end
    mu(i) = mean(select);
    sig(i) = std(select);
end

x = x(1:end-1) + (x(2) - x(1))/2;

plot(S, V, '.');
hold on;
plot(x, mu, x, mu + sig, x, mu - sig, 'r.-');
hold off



